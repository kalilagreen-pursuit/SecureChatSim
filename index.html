<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cybersecurity Incident Response - Slack Style</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        slack: {
                            purple: '#4A154B',
                            sidebar: '#3F0E40',
                            hover: '#350D36',
                            green: '#2D9D32',
                            text: '#1D1C1D',
                            light: '#F8F8F8',
                            border: '#E1E1E1'
                        }
                    },
                    fontFamily: {
                        slack: ['Slack-Lato', 'Lato', 'Lucida Grande', 'Lucida Sans Unicode', 'Tahoma', 'Sans-Serif'],
                    },
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Lato', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
        }
        
        .message-hover:hover {
            background-color: #f8f8f8;
        }
        
        .sidebar-item:hover {
            background-color: #350D36;
        }
        
        .channel-active {
            background-color: #1264A3;
            color: white;
        }
    </style>
</head>
<body class="h-screen overflow-hidden bg-white">
    <!-- Main Container -->
    <div class="flex h-full">
        <!-- Sidebar -->
        <div class="w-64 bg-slack-sidebar text-white flex flex-col">
            <!-- Workspace Header -->
            <div class="p-4 border-b border-slack-hover">
                <div class="flex items-center justify-between">
                    <h1 class="text-lg font-bold text-white">SecOps Team</h1>
                    <div class="w-3 h-3 bg-slack-green rounded-full"></div>
                </div>
                <div class="text-sm text-gray-300 mt-1">Security Operations</div>
            </div>
            
            <!-- Channels Section -->
            <div class="flex-1 overflow-y-auto">
                <div class="px-4 py-2">
                    <div class="text-gray-300 text-sm font-semibold mb-2">Channels</div>
                    <div class="space-y-1">
                        <div class="flex items-center px-2 py-1 rounded sidebar-item cursor-pointer channel-active">
                            <span class="mr-2">#</span>
                            <span class="text-sm">security-alerts</span>
                            <div class="ml-auto w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center">1</div>
                        </div>
                        <div class="flex items-center px-2 py-1 rounded sidebar-item cursor-pointer text-gray-300">
                            <span class="mr-2">#</span>
                            <span class="text-sm">incident-response</span>
                        </div>
                        <div class="flex items-center px-2 py-1 rounded sidebar-item cursor-pointer text-gray-300">
                            <span class="mr-2">#</span>
                            <span class="text-sm">threat-intel</span>
                        </div>
                        <div class="flex items-center px-2 py-1 rounded sidebar-item cursor-pointer text-gray-300">
                            <span class="mr-2">#</span>
                            <span class="text-sm">general</span>
                        </div>
                    </div>
                </div>
                
                <!-- Direct Messages Section -->
                <div class="px-4 py-2">
                    <div class="text-gray-300 text-sm font-semibold mb-2">Direct messages</div>
                    <div class="space-y-1">
                        <div class="flex items-center px-2 py-1 rounded sidebar-item cursor-pointer text-gray-300">
                            <div class="w-6 h-6 bg-blue-500 rounded mr-2 flex items-center justify-center text-white text-xs font-bold">AI</div>
                            <span class="text-sm">SecurityBot</span>
                            <div class="ml-auto w-2 h-2 bg-slack-green rounded-full"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Main Content Area -->
        <div class="flex-1 flex flex-col">
            <!-- Channel Header -->
            <div class="bg-white border-b border-slack-border px-6 py-3 flex items-center justify-between">
                <div class="flex items-center">
                    <h2 class="text-xl font-bold text-slack-text flex items-center">
                        <span class="mr-2">#</span>
                        security-alerts
                    </h2>
                    <div class="ml-4 text-sm text-gray-500">
                        <span class="mr-4">‚≠ê 3</span>
                        <span>üë• 12 members</span>
                    </div>
                </div>
                <div class="flex items-center space-x-2">
                    <button class="p-2 hover:bg-gray-100 rounded">üîç</button>
                    <button class="p-2 hover:bg-gray-100 rounded">‚ÑπÔ∏è</button>
                </div>
            </div>
            
            <!-- Chat Area -->
            <div id="chat-container" class="flex-1 overflow-y-auto bg-white">
                <!-- Date Divider -->
                <div class="flex items-center justify-center py-4">
                    <div class="bg-white border border-slack-border px-4 py-1 rounded-full text-xs font-semibold text-gray-600">
                        Today
                    </div>
                </div>
                
                <!-- Initial Agent message -->
                <div class="px-6 py-2 message-hover group">
                    <div class="flex items-start space-x-3">
                        <div class="w-9 h-9 bg-blue-500 rounded flex items-center justify-center text-white font-bold text-sm">AI</div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-baseline">
                                <span class="font-bold text-slack-text text-sm">SecurityBot</span>
                                <span class="ml-2 text-xs text-gray-500">APP 9:14 AM</span>
                            </div>
                            <div class="mt-1">
                                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-3">
                                    <div class="flex items-center mb-2">
                                        <span class="text-yellow-600 mr-2">‚ö†Ô∏è</span>
                                        <span class="font-bold text-yellow-800">Security Alert - Phishing Incident</span>
                                    </div>
                                    <p class="text-gray-700 mb-3">Alert triggered by a user-reported email. The email's subject is "Urgent Action Required: Password Reset". Initial analysis shows it originated from a known malicious domain. The user has not clicked any links.</p>
                                    <p class="font-semibold text-gray-800 mb-3">What would you like to do?</p>
                                </div>
                                <div class="flex flex-wrap gap-2">
                                    <button class="solution-btn bg-slack-purple hover:bg-opacity-90 text-white font-medium py-2 px-4 rounded transition-colors duration-200 text-sm" data-solution="1">
                                        üîí Quarantine Email & Notify User
                                    </button>
                                    <button class="solution-btn bg-gray-500 hover:bg-gray-600 text-white font-medium py-2 px-4 rounded transition-colors duration-200 text-sm" data-solution="2">
                                        ‚ùå Dismiss as False Positive
                                    </button>
                                    <button class="solution-btn bg-orange-500 hover:bg-orange-600 text-white font-medium py-2 px-4 rounded transition-colors duration-200 text-sm" data-solution="3">
                                        üöÄ Escalate to Tier 2
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="opacity-0 group-hover:opacity-100 transition-opacity">
                            <button class="p-1 hover:bg-gray-100 rounded text-xs">üòÄ</button>
                            <button class="p-1 hover:bg-gray-100 rounded text-xs">üí¨</button>
                            <button class="p-1 hover:bg-gray-100 rounded text-xs">‚ö°</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Message Input Area -->
            <div class="bg-white border-t border-slack-border p-4">
                <div class="relative">
                    <div class="border border-slack-border rounded-lg overflow-hidden">
                        <div class="px-3 py-2 border-b border-slack-border bg-gray-50">
                            <div class="text-sm text-gray-600">Message <strong>#security-alerts</strong></div>
                        </div>
                        <div class="p-3">
                            <input 
                                id="chat-input" 
                                type="text" 
                                placeholder="Type a message or question..." 
                                class="w-full border-none outline-none resize-none text-slack-text placeholder-gray-400"
                            >
                        </div>
                        <div class="px-3 py-2 bg-gray-50 border-t border-slack-border flex items-center justify-between">
                            <div class="flex items-center space-x-2">
                                <button class="p-1 hover:bg-gray-200 rounded text-gray-500">üìé</button>
                                <button class="p-1 hover:bg-gray-200 rounded text-gray-500">üòÄ</button>
                                <button class="p-1 hover:bg-gray-200 rounded text-gray-500">@</button>
                                <button class="p-1 hover:bg-gray-200 rounded text-gray-500">#</button>
                            </div>
                            <button 
                                id="send-btn" 
                                class="bg-slack-green hover:bg-green-700 text-white font-medium px-4 py-1 rounded text-sm transition-colors duration-200"
                            >
                                Send
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Simple in-memory database to simulate the agent "learning"
        const memoryDB = [];

        // Predefined playbook for agent responses
        const playbook = {
            '1': {
                response: 'Solution "Quarantine Email & Notify User" selected. The email has been quarantined, and an automated notification has been sent to the user.',
                isFinal: true
            },
            '2': {
                response: 'Solution "Dismiss as False Positive" selected. The alert has been marked as a false positive.',
                isFinal: true
            },
            '3': {
                response: 'Solution "Escalate to Tier 2" selected. The incident has been flagged for a senior analyst. Please provide additional context in the chat if needed.',
                isFinal: false
            },
            'default': {
                response: 'I am not sure how to respond to that. Please select one of the provided solutions or provide more context.',
                isFinal: false
            }
        };

        const chatContainer = document.getElementById('chat-container');
        const chatInput = document.getElementById('chat-input');
        const sendBtn = document.getElementById('send-btn');
        const solutionBtns = document.querySelectorAll('.solution-btn');

        // Function to add a new message to the chat container (XSS-safe)
        const addMessage = (sender, text) => {
            const messageElement = document.createElement('div');
            messageElement.classList.add('px-6', 'py-2', 'message-hover', 'group');

            const timestamp = new Date().toLocaleTimeString('en-US', { 
                hour: 'numeric', 
                minute: '2-digit',
                hour12: true 
            });

            // Create message structure using DOM methods for security
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('flex', 'items-start', 'space-x-3');

            // Avatar
            const avatar = document.createElement('div');
            avatar.classList.add('w-9', 'h-9', 'rounded', 'flex', 'items-center', 'justify-center', 'text-white', 'font-bold', 'text-sm');
            
            // Content container
            const contentDiv = document.createElement('div');
            contentDiv.classList.add('flex-1', 'min-w-0');

            // Header with name and timestamp
            const headerDiv = document.createElement('div');
            headerDiv.classList.add('flex', 'items-baseline');
            
            const nameSpan = document.createElement('span');
            nameSpan.classList.add('font-bold', 'text-slack-text', 'text-sm');
            
            const timestampSpan = document.createElement('span');
            timestampSpan.classList.add('ml-2', 'text-xs', 'text-gray-500');
            timestampSpan.textContent = timestamp;

            // Message content
            const messageContentDiv = document.createElement('div');
            messageContentDiv.classList.add('mt-1', 'text-slack-text');
            
            const messageParagraph = document.createElement('p');
            messageParagraph.textContent = text; // Safe text content, no HTML injection

            // Action buttons
            const actionsDiv = document.createElement('div');
            actionsDiv.classList.add('opacity-0', 'group-hover:opacity-100', 'transition-opacity');
            
            const emojiBtn = document.createElement('button');
            emojiBtn.classList.add('p-1', 'hover:bg-gray-100', 'rounded', 'text-xs');
            emojiBtn.textContent = 'üòÄ';
            
            const threadBtn = document.createElement('button');
            threadBtn.classList.add('p-1', 'hover:bg-gray-100', 'rounded', 'text-xs');
            threadBtn.textContent = 'üí¨';
            
            const moreBtn = document.createElement('button');
            moreBtn.classList.add('p-1', 'hover:bg-gray-100', 'rounded', 'text-xs');
            moreBtn.textContent = '‚ö°';

            if (sender === 'analyst') {
                avatar.classList.add('bg-green-500');
                avatar.textContent = 'U';
                nameSpan.textContent = 'Security Analyst';
            } else {
                avatar.classList.add('bg-blue-500');
                avatar.textContent = 'AI';
                nameSpan.textContent = 'SecurityBot';
                timestampSpan.textContent = 'APP ' + timestamp;
            }

            // Assemble the structure
            headerDiv.appendChild(nameSpan);
            headerDiv.appendChild(timestampSpan);
            
            messageContentDiv.appendChild(messageParagraph);
            
            actionsDiv.appendChild(emojiBtn);
            actionsDiv.appendChild(threadBtn);
            actionsDiv.appendChild(moreBtn);
            
            contentDiv.appendChild(headerDiv);
            contentDiv.appendChild(messageContentDiv);
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(contentDiv);
            messageDiv.appendChild(actionsDiv);
            
            messageElement.appendChild(messageDiv);
            chatContainer.appendChild(messageElement);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        };

        // Function to handle sending a message
        const sendMessage = () => {
            const message = chatInput.value.trim();
            if (message === '') return;

            addMessage('analyst', message);
            chatInput.value = '';

            // Simulate agent response
            setTimeout(() => {
                const response = playbook['default'].response;
                addMessage('agent', response);
            }, 1000);
        };

        // Function to handle solution button clicks
        const handleSolutionClick = (event) => {
            const solutionId = event.target.dataset.solution;
            const solutionText = event.target.textContent.trim();

            addMessage('analyst', solutionText);

            // Disable buttons once a solution is selected
            solutionBtns.forEach(btn => {
                btn.disabled = true;
                btn.classList.add('opacity-50', 'cursor-not-allowed');
            });
            
            // Simulate agent response and database update
            setTimeout(() => {
                const agentResponse = playbook[solutionId].response;
                addMessage('agent', agentResponse);
                
                if (playbook[solutionId].isFinal) {
                    // Ask for confirmation instead of automatically finalizing
                    const incidentData = {
                        incidentId: 'INC-' + Date.now(),
                        initialAlert: 'User-reported phishing email',
                        selectedSolution: solutionText
                    };
                    
                    setTimeout(() => {
                        addResolutionConfirmation(incidentData);
                    }, 800);
                }
            }, 1000);
        };

        // Function to add resolution confirmation question
        const addResolutionConfirmation = (incidentData) => {
            const messageElement = document.createElement('div');
            messageElement.classList.add('px-6', 'py-2', 'message-hover', 'group');

            const timestamp = new Date().toLocaleTimeString('en-US', { 
                hour: 'numeric', 
                minute: '2-digit',
                hour12: true 
            });

            // Create message structure
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('flex', 'items-start', 'space-x-3');

            // Avatar
            const avatar = document.createElement('div');
            avatar.classList.add('w-9', 'h-9', 'bg-blue-500', 'rounded', 'flex', 'items-center', 'justify-center', 'text-white', 'font-bold', 'text-sm');
            avatar.textContent = 'AI';
            
            // Content container
            const contentDiv = document.createElement('div');
            contentDiv.classList.add('flex-1', 'min-w-0');

            // Header with name and timestamp
            const headerDiv = document.createElement('div');
            headerDiv.classList.add('flex', 'items-baseline');
            
            const nameSpan = document.createElement('span');
            nameSpan.classList.add('font-bold', 'text-slack-text', 'text-sm');
            nameSpan.textContent = 'SecurityBot';
            
            const timestampSpan = document.createElement('span');
            timestampSpan.classList.add('ml-2', 'text-xs', 'text-gray-500');
            timestampSpan.textContent = 'APP ' + timestamp;

            // Message content with buttons
            const messageContentDiv = document.createElement('div');
            messageContentDiv.classList.add('mt-1', 'text-slack-text');
            
            const messageParagraph = document.createElement('p');
            messageParagraph.textContent = 'Is this incident now resolved?';
            messageParagraph.classList.add('mb-3');

            // Yes/No buttons
            const buttonContainer = document.createElement('div');
            buttonContainer.classList.add('flex', 'gap-2');

            const yesButton = document.createElement('button');
            yesButton.classList.add('bg-green-600', 'hover:bg-green-700', 'text-white', 'font-medium', 'py-2', 'px-4', 'rounded', 'transition-colors', 'duration-200', 'text-sm');
            yesButton.textContent = '‚úÖ Yes, Resolved';
            yesButton.addEventListener('click', () => {
                handleResolutionResponse(true, incidentData);
                yesButton.disabled = true;
                noButton.disabled = true;
                yesButton.classList.add('opacity-50', 'cursor-not-allowed');
                noButton.classList.add('opacity-50', 'cursor-not-allowed');
            });

            const noButton = document.createElement('button');
            noButton.classList.add('bg-orange-500', 'hover:bg-orange-600', 'text-white', 'font-medium', 'py-2', 'px-4', 'rounded', 'transition-colors', 'duration-200', 'text-sm');
            noButton.textContent = '‚ùå No, Needs More Action';
            noButton.addEventListener('click', () => {
                handleResolutionResponse(false, incidentData);
                yesButton.disabled = true;
                noButton.disabled = true;
                yesButton.classList.add('opacity-50', 'cursor-not-allowed');
                noButton.classList.add('opacity-50', 'cursor-not-allowed');
            });

            buttonContainer.appendChild(yesButton);
            buttonContainer.appendChild(noButton);

            // Action buttons
            const actionsDiv = document.createElement('div');
            actionsDiv.classList.add('opacity-0', 'group-hover:opacity-100', 'transition-opacity');
            
            const emojiBtn = document.createElement('button');
            emojiBtn.classList.add('p-1', 'hover:bg-gray-100', 'rounded', 'text-xs');
            emojiBtn.textContent = 'üòÄ';
            
            const threadBtn = document.createElement('button');
            threadBtn.classList.add('p-1', 'hover:bg-gray-100', 'rounded', 'text-xs');
            threadBtn.textContent = 'üí¨';
            
            const moreBtn = document.createElement('button');
            moreBtn.classList.add('p-1', 'hover:bg-gray-100', 'rounded', 'text-xs');
            moreBtn.textContent = '‚ö°';

            // Assemble the structure
            headerDiv.appendChild(nameSpan);
            headerDiv.appendChild(timestampSpan);
            
            messageContentDiv.appendChild(messageParagraph);
            messageContentDiv.appendChild(buttonContainer);
            
            actionsDiv.appendChild(emojiBtn);
            actionsDiv.appendChild(threadBtn);
            actionsDiv.appendChild(moreBtn);
            
            contentDiv.appendChild(headerDiv);
            contentDiv.appendChild(messageContentDiv);
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(contentDiv);
            messageDiv.appendChild(actionsDiv);
            
            messageElement.appendChild(messageDiv);
            chatContainer.appendChild(messageElement);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        };

        // Function to handle resolution response (Yes or No)
        const handleResolutionResponse = (isResolved, incidentData) => {
            if (isResolved) {
                // Add analyst response
                addMessage('analyst', '‚úÖ Yes, Resolved');
                
                // Store in database and show finalization message
                setTimeout(() => {
                    // Update the finalized timestamp to when user confirms resolution
                    incidentData.finalizedAt = new Date().toISOString();
                    memoryDB.push(incidentData);
                    addMessage('agent', '‚úÖ Solution finalized and stored in the database for future agent training.');
                    console.log('Memory Database:', memoryDB);
                    
                    // Add manager report option
                    setTimeout(() => {
                        addManagerReportOption(incidentData);
                    }, 500);
                }, 800);
            } else {
                // Add analyst response
                addMessage('analyst', '‚ùå No, Needs More Action');
                
                // Ask for additional measures
                setTimeout(() => {
                    addMessage('agent', 'What additional measures are needed to fully resolve this incident?');
                }, 800);
            }
        };

        // Function to add manager report option
        const addManagerReportOption = (incidentData) => {
            const messageElement = document.createElement('div');
            messageElement.classList.add('px-6', 'py-2', 'message-hover', 'group');

            const timestamp = new Date().toLocaleTimeString('en-US', { 
                hour: 'numeric', 
                minute: '2-digit',
                hour12: true 
            });

            // Create message structure
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('flex', 'items-start', 'space-x-3');

            // Avatar
            const avatar = document.createElement('div');
            avatar.classList.add('w-9', 'h-9', 'bg-blue-500', 'rounded', 'flex', 'items-center', 'justify-center', 'text-white', 'font-bold', 'text-sm');
            avatar.textContent = 'AI';
            
            // Content container
            const contentDiv = document.createElement('div');
            contentDiv.classList.add('flex-1', 'min-w-0');

            // Header with name and timestamp
            const headerDiv = document.createElement('div');
            headerDiv.classList.add('flex', 'items-baseline');
            
            const nameSpan = document.createElement('span');
            nameSpan.classList.add('font-bold', 'text-slack-text', 'text-sm');
            nameSpan.textContent = 'SecurityBot';
            
            const timestampSpan = document.createElement('span');
            timestampSpan.classList.add('ml-2', 'text-xs', 'text-gray-500');
            timestampSpan.textContent = 'APP ' + timestamp;

            // Message content with button
            const messageContentDiv = document.createElement('div');
            messageContentDiv.classList.add('mt-1', 'text-slack-text');
            
            const messageParagraph = document.createElement('p');
            messageParagraph.textContent = 'Would you like to generate a summary report for management?';
            messageParagraph.classList.add('mb-3');

            // Manager report button
            const reportButton = document.createElement('button');
            reportButton.classList.add('bg-blue-600', 'hover:bg-blue-700', 'text-white', 'font-medium', 'py-2', 'px-4', 'rounded', 'transition-colors', 'duration-200', 'text-sm');
            reportButton.textContent = 'üìä Generate Manager Report';
            reportButton.addEventListener('click', () => {
                generateManagerReport(incidentData);
                reportButton.disabled = true;
                reportButton.classList.add('opacity-50', 'cursor-not-allowed');
            });

            // Action buttons
            const actionsDiv = document.createElement('div');
            actionsDiv.classList.add('opacity-0', 'group-hover:opacity-100', 'transition-opacity');
            
            const emojiBtn = document.createElement('button');
            emojiBtn.classList.add('p-1', 'hover:bg-gray-100', 'rounded', 'text-xs');
            emojiBtn.textContent = 'üòÄ';
            
            const threadBtn = document.createElement('button');
            threadBtn.classList.add('p-1', 'hover:bg-gray-100', 'rounded', 'text-xs');
            threadBtn.textContent = 'üí¨';
            
            const moreBtn = document.createElement('button');
            moreBtn.classList.add('p-1', 'hover:bg-gray-100', 'rounded', 'text-xs');
            moreBtn.textContent = '‚ö°';

            // Assemble the structure
            headerDiv.appendChild(nameSpan);
            headerDiv.appendChild(timestampSpan);
            
            messageContentDiv.appendChild(messageParagraph);
            messageContentDiv.appendChild(reportButton);
            
            actionsDiv.appendChild(emojiBtn);
            actionsDiv.appendChild(threadBtn);
            actionsDiv.appendChild(moreBtn);
            
            contentDiv.appendChild(headerDiv);
            contentDiv.appendChild(messageContentDiv);
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(contentDiv);
            messageDiv.appendChild(actionsDiv);
            
            messageElement.appendChild(messageDiv);
            chatContainer.appendChild(messageElement);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        };

        // Function to generate and display manager report
        const generateManagerReport = (incidentData) => {
            const reportDate = new Date().toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            const reportTime = new Date().toLocaleTimeString('en-US', { 
                hour: 'numeric', 
                minute: '2-digit',
                hour12: true 
            });

            const reportText = `SECURITY INCIDENT SUMMARY REPORT

Date: ${reportDate}
Time: ${reportTime}
Incident ID: ${incidentData.incidentId}

INCIDENT OVERVIEW
Alert Type: Phishing Email Detection
Initial Alert: ${incidentData.initialAlert}
Reported By: End User
Severity Level: Medium

RESPONSE ACTIONS TAKEN
Selected Solution: ${incidentData.selectedSolution}
Response Time: < 2 minutes
Status: Resolved

TIMELINE
‚Ä¢ Alert received and analyzed
‚Ä¢ Security analyst reviewed incident details
‚Ä¢ Appropriate response action selected and executed
‚Ä¢ Incident logged and closed at ${new Date(incidentData.finalizedAt).toLocaleString()}

IMPACT ASSESSMENT
‚Ä¢ No systems compromised
‚Ä¢ No data breach occurred
‚Ä¢ User was protected from potential threat

RECOMMENDATION
Incident handled according to security protocols. No further action required.

Prepared by: Security Operations Team
Report Generated: ${reportDate} at ${reportTime}`;

            // Display the report as a formatted message
            const messageElement = document.createElement('div');
            messageElement.classList.add('px-6', 'py-2', 'message-hover', 'group');

            const timestamp = new Date().toLocaleTimeString('en-US', { 
                hour: 'numeric', 
                minute: '2-digit',
                hour12: true 
            });

            // Create message structure
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('flex', 'items-start', 'space-x-3');

            // Avatar
            const avatar = document.createElement('div');
            avatar.classList.add('w-9', 'h-9', 'bg-blue-500', 'rounded', 'flex', 'items-center', 'justify-center', 'text-white', 'font-bold', 'text-sm');
            avatar.textContent = 'AI';
            
            // Content container
            const contentDiv = document.createElement('div');
            contentDiv.classList.add('flex-1', 'min-w-0');

            // Header
            const headerDiv = document.createElement('div');
            headerDiv.classList.add('flex', 'items-baseline');
            
            const nameSpan = document.createElement('span');
            nameSpan.classList.add('font-bold', 'text-slack-text', 'text-sm');
            nameSpan.textContent = 'SecurityBot';
            
            const timestampSpan = document.createElement('span');
            timestampSpan.classList.add('ml-2', 'text-xs', 'text-gray-500');
            timestampSpan.textContent = 'APP ' + timestamp;

            // Report content with improved styling
            const reportDiv = document.createElement('div');
            reportDiv.classList.add('mt-3', 'bg-white', 'border', 'border-gray-200', 'rounded-lg', 'p-4', 'shadow-sm');
            
            // Report title
            const titleDiv = document.createElement('div');
            titleDiv.classList.add('text-center', 'mb-4', 'pb-2', 'border-b', 'border-gray-200');
            const titleH3 = document.createElement('h3');
            titleH3.classList.add('text-sm', 'font-bold', 'text-gray-800', 'uppercase', 'tracking-wide');
            titleH3.textContent = 'Security Incident Summary Report';
            titleDiv.appendChild(titleH3);
            
            // Report content - using safe DOM construction
            const reportContent = document.createElement('div');
            reportContent.classList.add('space-y-3', 'text-xs', 'text-gray-800');
            
            // Basic info section
            const createInfoRow = (label, value) => {
                const div = document.createElement('div');
                const strong = document.createElement('strong');
                strong.textContent = label + ':';
                div.appendChild(strong);
                div.appendChild(document.createTextNode(' ' + value));
                return div;
            };
            
            const createSectionTitle = (title) => {
                const div = document.createElement('div');
                div.classList.add('pt-2');
                const strong = document.createElement('strong');
                strong.classList.add('text-gray-900');
                strong.textContent = title;
                div.appendChild(strong);
                return div;
            };
            
            const createList = (items) => {
                const ul = document.createElement('ul');
                ul.classList.add('list-disc', 'list-inside', 'ml-2', 'space-y-1');
                items.forEach(item => {
                    const li = document.createElement('li');
                    li.textContent = item;
                    ul.appendChild(li);
                });
                return ul;
            };
            
            // Basic information
            reportContent.appendChild(createInfoRow('Date', reportDate));
            reportContent.appendChild(createInfoRow('Time', reportTime));
            reportContent.appendChild(createInfoRow('Incident ID', incidentData.incidentId));
            
            // Incident Overview
            reportContent.appendChild(createSectionTitle('INCIDENT OVERVIEW'));
            reportContent.appendChild(createInfoRow('Alert Type', 'Phishing Email Detection'));
            reportContent.appendChild(createInfoRow('Initial Alert', incidentData.initialAlert));
            reportContent.appendChild(createInfoRow('Reported By', 'End User'));
            reportContent.appendChild(createInfoRow('Severity Level', 'Medium'));
            
            // Response Actions
            reportContent.appendChild(createSectionTitle('RESPONSE ACTIONS TAKEN'));
            reportContent.appendChild(createInfoRow('Selected Solution', incidentData.selectedSolution));
            reportContent.appendChild(createInfoRow('Response Time', 'under 2 minutes'));
            reportContent.appendChild(createInfoRow('Status', 'Resolved'));
            
            // Timeline
            reportContent.appendChild(createSectionTitle('TIMELINE'));
            reportContent.appendChild(createList([
                'Alert received and analyzed',
                'Security analyst reviewed incident details',
                'Appropriate response action selected and executed',
                'Incident logged and closed at ' + new Date(incidentData.finalizedAt).toLocaleString()
            ]));
            
            // Impact Assessment
            reportContent.appendChild(createSectionTitle('IMPACT ASSESSMENT'));
            reportContent.appendChild(createList([
                'No systems compromised',
                'No data breach occurred',
                'User was protected from potential threat'
            ]));
            
            // Recommendation
            reportContent.appendChild(createSectionTitle('RECOMMENDATION'));
            const recDiv = document.createElement('div');
            recDiv.textContent = 'Incident handled according to security protocols. No further action required.';
            reportContent.appendChild(recDiv);
            
            // Footer
            const footerDiv = document.createElement('div');
            footerDiv.classList.add('pt-3', 'mt-4', 'border-t', 'border-gray-200', 'text-center', 'text-xs', 'text-gray-600');
            footerDiv.appendChild(createInfoRow('Prepared by', 'Security Operations Team'));
            footerDiv.appendChild(createInfoRow('Report Generated', reportDate + ' at ' + reportTime));
            reportContent.appendChild(footerDiv);
            
            reportDiv.appendChild(titleDiv);
            reportDiv.appendChild(reportContent);

            const copyButton = document.createElement('button');
            copyButton.classList.add('mt-3', 'bg-green-600', 'hover:bg-green-700', 'text-white', 'text-xs', 'px-3', 'py-1', 'rounded', 'transition-colors');
            copyButton.textContent = 'Copy Report';
            copyButton.addEventListener('click', () => {
                try {
                    navigator.clipboard.writeText(reportText);
                    copyButton.textContent = 'Copied!';
                    setTimeout(() => {
                        copyButton.textContent = 'Copy Report';
                    }, 2000);
                } catch (err) {
                    console.error('Failed to copy report:', err);
                    copyButton.textContent = 'Copy failed';
                    setTimeout(() => {
                        copyButton.textContent = 'Copy Report';
                    }, 2000);
                }
            });

            // Action buttons
            const actionsDiv = document.createElement('div');
            actionsDiv.classList.add('opacity-0', 'group-hover:opacity-100', 'transition-opacity');
            
            const emojiBtn = document.createElement('button');
            emojiBtn.classList.add('p-1', 'hover:bg-gray-100', 'rounded', 'text-xs');
            emojiBtn.textContent = 'üòÄ';

            // Assemble the structure
            headerDiv.appendChild(nameSpan);
            headerDiv.appendChild(timestampSpan);
            
            reportDiv.appendChild(copyButton);
            
            contentDiv.appendChild(headerDiv);
            contentDiv.appendChild(reportDiv);
            
            actionsDiv.appendChild(emojiBtn);
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(contentDiv);
            messageDiv.appendChild(actionsDiv);
            
            messageElement.appendChild(messageDiv);
            chatContainer.appendChild(messageElement);
            chatContainer.scrollTop = chatContainer.scrollHeight;

            addMessage('agent', 'üìä Manager report generated successfully! You can copy the report above and send it via email or your preferred communication method.');
        };
        
        // Event listeners
        sendBtn.addEventListener('click', sendMessage);
        chatInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                sendMessage();
            }
        });
        solutionBtns.forEach(btn => btn.addEventListener('click', handleSolutionClick));

        // Auto-focus on input
        chatInput.focus();
    </script>
</body>
</html>